<html>
  <head>
    <meta charset="utf-8">
    <title>rvyt: Reddit Videos to YouTube Playlist</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le fav and touch icons -->
    <!--
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png">
    -->
  </head>
    <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/">rvyt</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="active"><a href="/">Home</a></li>
              <li><a href="/html/about.html">About</a></li>
              <li><a href="/html/contact.html">Contact</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
    <div class="container">
        <div class="span6">

<h1>Result</h1>

<p>Your playlist is <a href="{{plist_url}}">here</a>.  
It is <span id="percent_complete">0</span>% complete.</p>

<h2>Errors</h2>

Errors that the application encountered will be listed below.

<ol id="errors"></ol>

        </div> <!-- /span -->
    </div> <!-- /container -->

<!-- Le javascript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<!--
<script src="js/jquery.js"></script>
<script src="js/bootstrap-transition.js"></script>
<script src="js/bootstrap-alert.js"></script>
<script src="js/bootstrap-modal.js"></script>
<script src="js/bootstrap-dropdown.js"></script>
<script src="js/bootstrap-scrollspy.js"></script>
<script src="js/bootstrap-tab.js"></script>
<script src="js/bootstrap-tooltip.js"></script>
<script src="js/bootstrap-popover.js"></script>
<script src="js/bootstrap-button.js"></script>
<script src="js/bootstrap-collapse.js"></script>
<script src="js/bootstrap-carousel.js"></script>
<script src="js/bootstrap-typeahead.js"></script>
-->

<script src='/_ah/channel/jsapi'></script>
<!-- 
The JavaScript reference says that all JS needs to go in the body:
http://code.google.com/appengine/docs/python/channel/javascript.html
This is required for the Django string substitution stuff to work.

It's a real pain in the ass.
http://vim.wikia.com/wiki/How_to_stop_auto_indenting

:setlocal noautoindent
:setlocal nocindent
:setlocal nosmartindent
:setlocal indentexpr=
-->
<script type="text/javascript" src="js/make.js"></script>
<script type="text/javascript">
onOpen = function() {
    console.debug('Opened socket')
    var request = new XMLHttpRequest();
    request.open('POST', '/opened');
    var params = { 
            'channel_id' : '{{channel_id}}',
            'plist_uri' : '{{plist_uri}}',
            'limit' : '{{limit}}' };
    //
    // From O'Reilly textbook page 503
    // Replace ALL encoded spaces using regular expressions.
    //
    var pairs = [ ];
    for (var name in params) {
        var value = params[name].toString();
        name = encodeURIComponent(name).replace(/%20/g, '+');
        value = encodeURIComponent(value).replace(/%20/g, '+');
        pairs.push(name + '=' + value);
    }
    request.setRequestHeader(
            'Content-Type', 
            'application/x-www-form-urlencoded')

    data = pairs.join('&')
    request.send(data);
};

var completed = 0;
var percentComplete = document.getElementById('percent_complete');
var errors = document.getElementById('errors');
onMessage = function(message) {
    completed += 1;
    data = JSON.parse(message['data']);
    if ('error' in data) {
        var li = document.createElement('li');
        li.innerHTML = '<a href="{0}">{0}</a> ({1})'.format(
                data['url'], data['error']);
        errors.appendChild(li)
    }
    percent_complete.innerHTML = (100*completed/{{limit}}).toFixed(0);
};

onError = function(message) {
    console.debug("Error:" + messageToStr(message));
};

onClose = function() {
    console.debug("Closed socket");
};

if ('{{token}}') {
    var channel = new goog.appengine.Channel('{{ token }}');
    var handler = { 'onopen' : onOpen, 'onmessage' : onMessage,
                    'onerror' : onError, 'onclose' : onClose }
    var socket = channel.open(handler);
}
        </script>
    </body>
</html>
